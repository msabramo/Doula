_mixin=function(target,source){for(var x in source){target[x]=source[x];}};var DataEventManager={subscribe:function(event,fn){$(this).bind(event,fn);},publish:function(event,data){$(this).trigger(event,data);}};_inArray=function(key,array,attribute){for(var i=0;i<array.length;i++){var item=array[i];if(typeof(item)=='object'){if(key==item[attribute])return item;}
else{if(key==item)return item;}}
return false;};_withoutArray=function(array,key,attribute){var arrayWithout=[];for(var i=0;i<array.length;i++){var item=array[i];if(typeof(item)=='object'){if(array!=item[attribute])arrayWithout.push(item);}
else{if(array!=item)arrayWithout.push(item);}}
return arrayWithout;};var AJAXUtil={post:function(url,params,onDone,onFail,msg){this._send('POST',url,params,onDone,onFail,msg);},get:function(url,params,onDone,onFail,msg){this._send('GET',url,params,onDone,onFail,msg);},_send:function(type,url,params,onDone,onFail,msg){onDone=$.proxy(onDone,this);if(typeof(onFail)=='function')onFail=$.proxy(onFail,this);if(msg)Notifier.info(msg,false);$.ajax({url:url,type:type,data:this._getDataValues(params),error:function(){if(typeof(onFail)=='function'){onFail(rslt);}
else{AJAXUtil._showStandardErrorMessage(rslt);}},success:function(response){try{if(msg){setTimeout(function(){Notifier.hide();},1500);}
rslt=(typeof(response)=='string')?$.parseJSON(response):response;if(rslt.success){onDone(rslt);}
else{if(typeof(onFail)=='function'){onFail(rslt);}
else{Notifier.hide();AJAXUtil._showStandardErrorMessage(rslt);}}}
catch(err){onDone(response);}}});},_getDataValues:function(params){var dataValues='';var count=0;for(var key in params){if(dataValues!=='')dataValues+='&';dataValues+=key+'='+encodeURIComponent(params[key]);}
return dataValues;},_showStandardErrorMessage:function(rslt){$('#modal-error').on('show',function(){$('#modal-error-msg').html(rslt.msg);$('#modal-error-close').on('click',function(){$('#modal-error').modal('hide');return false;});});$('#modal-error').modal();}};;var Filter={cookieName:'',filterableEls:$('.filterable'),init:function(cookieName){this.cookieName=cookieName;$('#clear')._on('click',this.clearFilter,this);$('#filter')._on('keyup',this.filterServices,this,allowEventToBubble=true);this.initFilterBox();},clearFilter:function(){$('#filter').val('').keyup().focus();},filterServices:function(event,filter){var searchText=$.trim(filter.val().toLowerCase());$.cookie(this.cookieName,searchText);var searchArray=searchText.split(',');this.filterableEls.each($.proxy(function(i,el){el=$(el);var filterData=el.data('filter-data').toLowerCase();if(searchText===''){el.show();}
else if(this.inSearchArray(searchArray,filterData)){el.show();}
else{el.hide();}},this));},inSearchArray:function(searchArray,text){for(var i=0;i<searchArray.length;i++){var searchPart=$.trim(searchArray[i]);if(searchPart==='')continue;if(text.indexOf(searchPart)!=-1){return true;}}
return false;},initFilterBox:function(){var searchText=$.cookie(this.cookieName);$('#filter').val(searchText).keyup().focus();}};;var Site={init:function(){this.site=__site;_mixin(this,AJAXUtil);this.bindToUIActions();this.bindToDataActions();},bindToUIActions:function(){Filter.init('serviceFilter.'+this.site.name);},bindToDataActions:function(){$('#lock-site')._on('click',this.toggleSiteLock,this);},toggleSiteLock:function(event,lockButton){if(!lockButton.hasClass('disabled')){var params={'lock':'true'};var msg='Locking site. Please be patient and stay awesome.';if(lockButton.hasClass('locked')){params={'lock':'false'};msg='Unlocking site. Please be patient and stay awesome.';}
var url='/sites/'+this.site.name_url+'/lock';this.post(url,params,this.doneToggleSiteLock,false,msg);}},doneToggleSiteLock:function(rslt){var lockButton=$('#lock-site');if(lockButton.hasClass('locked')){lockButton.removeClass('locked').addClass('unlocked').html('<i class="icon-lock icon-black"></i> Lock Site');}
else{lockButton.removeClass('unlocked').addClass('locked').html('<i class="icon-lock icon-black"></i> Unlock Site');}}};$(document).ready(function(){Site.init();});;var ServiceLabel={originalLabelWidths:{},DEFAULT_LABEL_LENGTH:20,CHAR_MULTIPLIER:6,init:function(){_mixin(this,AJAXUtil);$('a.edit-label')._on('click',this.handleLabelEdit,this);$('span.accord-title-label input')._on('blur',this.handleLabelLostFocus,this);$('span.accord-title-label input')._on('keydown',this.handleLabelKeydown,this,true);},handleLabelEdit:function(event,link){var serviceName=link.data("service");var link=$("#label-for-"+serviceName);link.addClass('hidden');var input=$("#input-label-for-"+serviceName);this.resizeLabelInput(input);input.addClass('active').focus();},handleLabelLostFocus:function(event,input){this.handleLabelSave(input);},handleLabelKeydown:function(event,input){if(event.keyCode==13){this.handleLabelSave(input);}
this.resizeLabelInput(input);},handleLabelSave:function(input){input.removeClass('active');var siteName=input.data("site");var serviceName=input.data("service");var label=$("#label-for-"+serviceName);var text=$.trim(input.val());label.html(text).removeClass('hidden');var url='/sites/'+siteName+'/'+serviceName+'/label';var params={'label':text};var msg='Saving label. Please be patient and stay awesome.';this.post(url,params,this.doneHandleLabelSave,null,msg);},doneHandleLabelSave:function(rslt){},resizeLabelInput:function(input){var text=input.val();if(!this.originalLabelWidths[input.attr('id')]){this.originalLabelWidths[input.attr('id')]=input.width();}
if(text.length>this.DEFAULT_LABEL_LENGTH){var moreChars=text.length-this.DEFAULT_LABEL_LENGTH;input.css('width',this.originalLabelWidths[input.attr('id')]+(moreChars*this.CHAR_MULTIPLIER));}}};$(document).ready(function(){ServiceLabel.init();});;