<div id="mini-dashboard-detail-releases" class="hide mini-dashboard-detail {% if last_release.production %}mini-dashboard-detail-prod{% endif %}">
  {% if last_release %}

  <p style="font-size: 115%; margin-top: 15px;">
    {% if last_release.release_number > 0 %}
      Release <strong>#{{last_release.release_number}}</strong> sent to <strong>{{ service.name }}</strong> on <strong>{{ site.name }}</strong> {{last_release.date|relative_datetime}}.
    {% else %}
      Release sent to <strong>{{ service.name }}</strong> on <strong>{{ site.name }}</strong> {{last_release.date|relative_datetime}}.
    {% endif %}
  </p>
  {% if last_release.release_number > 0 %}
  <p style="font-size: 115%;">
    <i class="icon-star"></i>
    Sent to production {{last_release.date|relative_datetime}}.
  </p>
  {% endif %}

  <br />

  <table class="table table-bordered">
    <thead>
      <tr class="title">
        <th>Package Name</th>
        <th>Release Version</th>
        <th>Current Version</th>
        <th>Compare View</th>
      </tr>
    </thead>
    <tbody>
      {% if diff['changed_packages'].keys()|length < 1 %}
        <tr>
          <td>&nbsp;</td>
          <td colspan="3">No package changes</td>
        </tr>
      {% endif %}

      {% for name, package_diff in diff['changed_packages'].iteritems()|sort %}
        <tr>
          {% if package_diff['package'].get_github_info() %}
            <td>{{name}}</td>
            <td>
              <a target="_blank" href="http://code.corp.surveymonkey.com/devmonkeys/{{package_diff['package'].name}}/tree/v{{package_diff['release_version']}}">
                {{package_diff['release_version']}}
              </a>
            </td>
            <td>
              <a target="_blank" href="http://code.corp.surveymonkey.com/devmonkeys/{{package_diff['package'].name}}/tree/v{{package_diff['current_version']}}">
                {{package_diff['current_version']}}
              </a>
            </td>

            <td>
              <a target="_blank" href="http://code.corp.surveymonkey.com/devmonkeys/{{package_diff['package'].name}}/compare/v{{package_diff['current_version']}}...v{{package_diff['release_version']}}">
                {{package_diff['current_version']}}...{{package_diff['release_version']}}
              </a>
            </td>
          {% else %}
            <td>{{name}}</td>
            <td>{{package_diff['release_version']}}</td>
            <td>{{package_diff['current_version']}}</td>
            <td>&nbsp;</td>
          {% endif %}
        </tr>
      {% endfor %}

      <tr class="title">
        <th>Config Files</th>
        <th>Current Commit</th>
        <th>Release Commit</th>
        <th>Compare View</th>
      </tr>

      <tr>
        <!--
        Need the config commit date. the commit sha1.
        -->
        <td rowspan="2">&nbsp;</td>
        <td rowspan="2"><a target="_blank" href="http://code.corp.surveymonkey.com/config/anweb/commit/{{service.config['commit']}}">
          {{service.config['commit']|truncate(7, true, "")}}
        </a></td>
        <td rowspan="2">
          <!-- alextodo. will need the config dir's name -->
          {% if last_release.sha1_etc %}
            <a target="_blank" href="http://code.corp.surveymonkey.com/config/{{service.comparable_name}}/commit/{{last_release.sha1_etc}}">
            {{last_release.sha1_etc}}
            </a>
          {% endif %}
        </td>
        <td>
          {% if last_release.sha1_etc %}
            <!-- alextodo. will need the config dir's name -->
            <a href="http://code.corp.surveymonkey.com/config/{{service.comparable_name}}/compare/{{service.config['commit']|truncate(7, true, "")}}...{{last_release.sha1_etc}}">
              {{service.config['commit']|truncate(7, true, "")}}...{{last_release.sha1_etc}}
            </a>
          {% endif %}
        </td>
      </tr>
    </tbody>
  </table>
  {% else %}
    <p>The last release date is <strong>unknown</strong>.</p>
  {% endif %}
</div>