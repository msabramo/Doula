{% extends 'layouts/base.html' %}
{% block content %}
<div class="title">
  <h2>{{ env.name }}</h2>
</div>
<div class="accordion group" id="site-accordion">

  {% for key_val_pair in env.services|dictsort %}
  {% set service = key_val_pair[1] %}

  <div class="accordion-group">
    <div class="accordion-heading group">
      <a id="link_{{ service.name_url }}" class="accordion-toggle accord-title" data-target="#collapse_{{ service.name_url }}" data-toggle="collapse" data-parent="#site-accordion" href="#">
        <span class="{{ service.get_status()|get_status_class }}"></span>
        {{ service.name }}
      </a>

      <a href="/envs/{{ env.name_url }}/{{ service.name_url }}" class="accord-link">
        Release Actions
      </a>
    </div>
    <!-- form that actually gets collapsed -->
    <div id="collapse_{{ service.name_url }}" 
    class="accordion-body collapse" style="height: auto; ">
      <div class="accordion-inner">
        <form class="well">
          <label>Tag</label>
          <input id="tag_{{ service.name_url }}" class="input-xlarge" type="text" />
          <span class="instruct">Last tag: <strong>{{ service.last_tag.name }}</strong></span>
          <label>Commit Message:</label>
          <textarea class="input-xlarge" id="msg_{{ service.name_url }}" cols="40" rows="5" required placeholder="Don’t make something unless it is both necessary and useful; but if it is both necessary and useful, don’t hesitate to make it beautiful."></textarea>

          <div class="">
            <button type="submit" class="btn">Tag Service</button>
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- end of individual  env -->
  {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script>
  var __env = {{ env_json|safe }};
  var __token = "{{ token|safe }}";
</script>

<script>
  $('.collapse').collapse("hide");
</script>
{% endblock %}