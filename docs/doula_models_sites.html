<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>sites.py</title>
  <link rel="stylesheet" href="pycco.css">
</head>
<body>
<!-- fly bar -->
<div id="flybar">
<a id="nav-logo" href="index.html">Doula Documentation</a>

<div class="flybar-language">
  <div class="dropdown">
    <a id="pages-dropdown" class="flybar-button">Files
      <b class="caret"></b>
    </a>
    <ul class="dropdown-menu">
      <li><a href="build_lib_doula___init__.html">build/lib/doula/__init__.py</a></li>
      <li><a href="build_lib_doula_cache.html">build/lib/doula/cache.py</a></li>
      <li><a href="build_lib_doula_helper_filters.html">build/lib/doula/helper_filters.py</a></li>
      <li><a href="build_lib_doula_models_audit.html">build/lib/doula/models/audit.py</a></li>
      <li><a href="build_lib_doula_models_site_tag_history.html">build/lib/doula/models/site_tag_history.py</a></li>
      <li><a href="build_lib_doula_models_sites.html">build/lib/doula/models/sites.py</a></li>
      <li><a href="build_lib_doula_models_sites_dal.html">build/lib/doula/models/sites_dal.py</a></li>
      <li><a href="build_lib_doula_static_minify_js_script.html">build/lib/doula/static/minify/js_script.py</a></li>
      <li><a href="build_lib_doula_static_minify_jsmin.html">build/lib/doula/static/minify/jsmin.py</a></li>
      <li><a href="build_lib_doula_util.html">build/lib/doula/util.py</a></li>
      <li><a href="build_lib_doula_views.html">build/lib/doula/views.py</a></li>
      <li><a href="doula___init__.html">doula/__init__.py</a></li>
      <li><a href="doula_cache.html">doula/cache.py</a></li>
      <li><a href="doula_helper_filters.html">doula/helper_filters.py</a></li>
      <li><a href="doula_models_audit.html">doula/models/audit.py</a></li>
      <li><a href="doula_models_site_tag_history.html">doula/models/site_tag_history.py</a></li>
      <li><a href="doula_models_sites.html">doula/models/sites.py</a></li>
      <li><a href="doula_models_sites_dal.html">doula/models/sites_dal.py</a></li>
      <li><a href="doula_static_minify_js_script.html">doula/static/minify/js_script.py</a></li>
      <li><a href="doula_static_minify_jsmin.html">doula/static/minify/jsmin.py</a></li>
      <li><a href="doula_tests_test_audit.html">doula/tests/test_audit.py</a></li>
      <li><a href="doula_tests_test_helper_filters.html">doula/tests/test_helper_filters.py</a></li>
      <li><a href="doula_tests_test_sites.html">doula/tests/test_sites.py</a></li>
      <li><a href="doula_tests_test_sites_dal.html">doula/tests/test_sites_dal.py</a></li>
      <li><a href="doula_tests_test_sites_dao.html">doula/tests/test_sites_dao.py</a></li>
      <li><a href="doula_tests_tests.html">doula/tests/tests.py</a></li>
      <li><a href="doula_util.html">doula/util.py</a></li>
      <li><a href="doula_views.html">doula/views.py</a></li>
      <li><a href="fabfile.html">fabfile.py</a></li>
      <li><a href="setup.html">setup.py</a></li>
      <li><a href="setup_initial.html">setup/initial.py</a></li>
    </ul>
  </div>
</div>
</div>
<!-- end of fly bar -->

<div id='container'>
  <div id="background"></div>
  <div class='section'>
    <div class='docs'><h1>sites.py</h1></div>
  </div>
  <div class='clearall'>
  <div class='section' id='section-0'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-0'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">operator</span>

<span class="kn">from</span> <span class="nn">doula.util</span> <span class="kn">import</span> <span class="n">dirify</span>
<span class="kn">from</span> <span class="nn">doula.util</span> <span class="kn">import</span> <span class="n">dumps</span>
<span class="kn">from</span> <span class="nn">doula.models.audit</span> <span class="kn">import</span> <span class="n">Audit</span>
<span class="kn">from</span> <span class="nn">doula.models.sites_dal</span> <span class="kn">import</span> <span class="n">SiteDAL</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-1'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-1'>#</a>
      </div>
      <p>Defines the Data Models for Doula and Bambino.</p>
<p>sites
  Site
    nodes
      applications
        Application
          packages
            Package
    applications
      Application
        packages
          Package</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;doula&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-2'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-2'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Site</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-3'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-3'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s">&#39;unknown&#39;</span><span class="p">,</span> <span class="n">nodes</span><span class="o">=</span><span class="p">{},</span> <span class="n">applications</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_url</span> <span class="o">=</span> <span class="n">dirify</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applications</span> <span class="o">=</span> <span class="n">applications</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-4'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-4'>#</a>
      </div>
      <p>The status of the site is the most serious status of all it's applications.
The more serious the status, the higher the status value number.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-5'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-5'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">status_value</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">status_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;unknown&#39;</span>                 <span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">&#39;deployed&#39;</span>                <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39;tagged&#39;</span>                  <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s">&#39;change_to_config&#39;</span>        <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s">&#39;change_to_app&#39;</span>           <span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s">&#39;change_to_app_and_config&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s">&#39;uncommitted_changes&#39;</span>     <span class="p">:</span> <span class="mi">4</span>
        <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">app</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">app_status_value</span> <span class="o">=</span> <span class="n">status_values</span><span class="p">[</span><span class="n">app</span><span class="o">.</span><span class="n">get_status</span><span class="p">()]</span>
            
            <span class="k">if</span> <span class="n">app_status_value</span> <span class="o">&gt;</span> <span class="n">status_value</span><span class="p">:</span>
                <span class="n">status_value</span> <span class="o">=</span> <span class="n">app_status_value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-6'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-6'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">all_logs</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>

        <span class="k">for</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">app</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">all_logs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">get_logs</span><span class="p">())</span>
        
        <span class="k">return</span> <span class="n">all_logs</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-7'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-7'>#</a>
      </div>
      <p>Take the simple dictionary version of a site object, i.e.
    {name:value, nodes[{'name':value, 'site':value, 'url':value}]}
and return an actual Site object with all the nodes and applications
built as well.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">build_site</span><span class="p">(</span><span class="n">simple_site</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-8'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-8'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">site</span> <span class="o">=</span> <span class="n">Site</span><span class="p">(</span><span class="n">simple_site</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">site</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">Site</span><span class="o">.</span><span class="n">_build_nodes</span><span class="p">(</span><span class="n">simple_site</span><span class="p">[</span><span class="s">&#39;nodes&#39;</span><span class="p">])</span>
        <span class="n">site</span><span class="o">.</span><span class="n">applications</span> <span class="o">=</span> <span class="n">Site</span><span class="o">.</span><span class="n">_get_combined_applications</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">site</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-9'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-9'>#</a>
      </div>
      <p>Takes the nodes with format:
    nodes[{'name':value, 'site':value, 'url':value}]
And builds Node objects</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_build_nodes</span><span class="p">(</span><span class="n">simple_nodes</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-10'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-10'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">nodes</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">simple_nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">n</span><span class="p">[</span><span class="s">&#39;site&#39;</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="s">&#39;url&#39;</span><span class="p">])</span>
            <span class="n">node</span><span class="o">.</span><span class="n">load_applications</span><span class="p">()</span>
            <span class="n">nodes</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
        
        <span class="k">return</span> <span class="n">nodes</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-11'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-11'>#</a>
      </div>
      <p>Takes the nodes (contains actual Node objects) and 
builds the applications as a combined list of their 
applications for the entire site.</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_combined_applications</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-12'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-12'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">combined_applications</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
        
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">app_name</span><span class="p">,</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">applications</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="n">combined_applications</span><span class="p">[</span><span class="n">app_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">app</span>
        
        <span class="k">return</span> <span class="n">combined_applications</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-13'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-13'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-14'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-14'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">site_name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">applications</span><span class="o">=</span><span class="p">{}):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_url</span> <span class="o">=</span> <span class="n">dirify</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_name</span> <span class="o">=</span> <span class="n">site_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applications</span> <span class="o">=</span> <span class="n">applications</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-15'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-15'>#</a>
      </div>
      <p>Update the applications</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">load_applications</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-16'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-16'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">applications</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
            
            <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="s">&#39;/applications&#39;</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-17'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-17'>#</a>
      </div>
      <p>If the response is non 200, we raise an error</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">rslt</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">app</span> <span class="ow">in</span> <span class="n">rslt</span><span class="p">[</span><span class="s">&#39;applications&#39;</span><span class="p">]:</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span><span class="n">app</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
                <span class="n">a</span><span class="o">.</span><span class="n">current_branch_app</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;current_branch_app&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">change_count_app</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;change_count_app&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">change_count_config</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;change_count_config&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">is_dirty_config</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;is_dirty_config&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">last_tag_config</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;last_tag_config&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">remote</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;remote&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">last_tag_app</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;last_tag_app&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">last_tag_message</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;last_tag_message&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">current_branch_config</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;current_branch_config&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">changed_files</span> <span class="o">=</span> <span class="n">app</span><span class="p">[</span><span class="s">&#39;changed_files&#39;</span><span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
                <span class="n">a</span><span class="o">.</span><span class="n">add_packages</span><span class="p">(</span><span class="n">app</span><span class="p">[</span><span class="s">&#39;packages&#39;</span><span class="p">])</span>
                <span class="n">a</span><span class="o">.</span><span class="n">add_tags_from_dict</span><span class="p">(</span><span class="n">app</span><span class="p">[</span><span class="s">&#39;tags&#39;</span><span class="p">])</span>
                
                <span class="bp">self</span><span class="o">.</span><span class="n">applications</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">name_url</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Unable to contact node {0} at URL {1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Unable to load applications. Error: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">applications</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-18'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-18'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Application</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-19'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-19'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">site_name</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span>
        <span class="n">current_branch_app</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">current_branch_config</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="n">change_count_app</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">change_count_config</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="n">is_dirty_app</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">is_dirty_config</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">last_tag_app</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">last_tag_config</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">last_tag_message</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">remote</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">repo</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">packages</span><span class="o">=</span><span class="p">[],</span> <span class="n">changed_files</span><span class="o">=</span><span class="p">[],</span> <span class="n">tags</span><span class="o">=</span><span class="p">[]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">site_name</span> <span class="o">=</span> <span class="n">site_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="n">node_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_url</span> <span class="o">=</span> <span class="n">dirify</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">current_branch_app</span> <span class="o">=</span> <span class="n">current_branch_app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_branch_config</span> <span class="o">=</span> <span class="n">current_branch_config</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">change_count_app</span> <span class="o">=</span> <span class="n">change_count_app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_count_config</span> <span class="o">=</span> <span class="n">change_count_config</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">is_dirty_app</span> <span class="o">=</span> <span class="n">is_dirty_app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_dirty_config</span> <span class="o">=</span> <span class="n">is_dirty_config</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">last_tag_app</span> <span class="o">=</span> <span class="n">last_tag_app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_tag_config</span> <span class="o">=</span> <span class="n">last_tag_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_tag_message</span> <span class="o">=</span> <span class="n">last_tag_message</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">remote</span> <span class="o">=</span> <span class="n">remote</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">packages</span> <span class="o">=</span> <span class="n">packages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed_files</span> <span class="o">=</span> <span class="n">changed_files</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">tags</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-20'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-20'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">add_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pckgs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">pckgs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Package</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-21'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-21'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">add_tags_from_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags_as_dicts</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags_as_dicts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tag</span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">],</span> <span class="n">tag</span><span class="p">[</span><span class="s">&#39;date&#39;</span><span class="p">],</span> <span class="n">tag</span><span class="p">[</span><span class="s">&#39;message&#39;</span><span class="p">]))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_last_tag</span><span class="p">()</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-22'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-22'>#</a>
      </div>
      <p>Use the remote url to return the Github Comapre view URL.
The Github Compare URL has the format:
http://<GITHUB_URL>/<USER>/<REPO>/compare/<START>...<END>
For us this means
http://code.corp.surveymonkey.com/DevOps/[name]/compare/[last_tag_app]...[current_branch_app]</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_compare_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-23'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-23'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;http&#39;</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-24'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-24'>#</a>
      </div>
      <p>parses http://code.corp.surveymonkey.com/tbone/anweb.git type remote</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;http:\/\/([\w\.]+)\/([\w\d]+)\/([\w\d]+)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-25'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-25'>#</a>
      </div>
      <p>parses git@code.corp.surveymonkey.com:tbone/anweb-1.git type remote</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">r&#39;@([\w\.]+):([\w\d]+)\/([\w\d]+)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">remote</span><span class="p">)</span>
        
        <span class="n">compare_url</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="n">compare_url</span> <span class="o">=</span> <span class="s">&#39;http://&#39;</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">compare_url</span><span class="o">+=</span> <span class="s">&#39;/compare/&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_tag</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;...&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_branch_app</span>
        
        <span class="k">return</span> <span class="n">compare_url</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-26'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-26'>#</a>
      </div>
      <p>Tag the current application</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-27'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-27'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;tag&#39;</span><span class="p">:</span> <span class="n">tag</span><span class="p">,</span> <span class="s">&#39;description&#39;</span><span class="p">:</span> <span class="n">msg</span><span class="p">,</span> <span class="s">&#39;apps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">+</span> <span class="s">&#39;/tag&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-28'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-28'>#</a>
      </div>
      <p>If the response is non 200, we raise an error</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s">&#39;tagged&#39;</span>
        
        <span class="n">audit</span> <span class="o">=</span> <span class="n">Audit</span><span class="p">()</span>
        <span class="n">audit</span><span class="o">.</span><span class="n">log_action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;tag&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-29'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-29'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">_update_last_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_tag_app</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_tag</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_tag_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_tag</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-30'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-30'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">last_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-31'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-31'>#</a>
      </div>
      <p>Initialize an empty tag if it doesn't tag exist</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="n">latest_tag</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">latest_tag_date</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">date</span> <span class="o">&gt;</span> <span class="n">latest_tag_date</span><span class="p">:</span>
                <span class="n">latest_tag</span> <span class="o">=</span> <span class="n">tag</span>
                <span class="n">latest_tag_date</span> <span class="o">=</span> <span class="n">tag</span><span class="o">.</span><span class="n">date</span>
        
        <span class="k">return</span> <span class="n">latest_tag</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-32'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-32'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s">&#39;tagged&#39;</span> <span class="ow">and</span> <span class="n">SiteDAL</span><span class="o">.</span><span class="n">is_deployed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_tag</span><span class="p">):</span>
            <span class="k">return</span> <span class="s">&#39;deployed&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-33'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-33'>#</a>
      </div>
      <p>Mark an application as deployed</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">mark_as_deployed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-34'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-34'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s">&#39;deployed&#39;</span>
        <span class="n">SiteDAL</span><span class="o">.</span><span class="n">save_application_as_deployed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        
        <span class="n">audit</span> <span class="o">=</span> <span class="n">Audit</span><span class="p">()</span>
        <span class="n">audit</span><span class="o">.</span><span class="n">log_action</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;deploy&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-35'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-35'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_logs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">audit</span> <span class="o">=</span> <span class="n">Audit</span><span class="p">()</span>
        <span class="n">app_logs</span> <span class="o">=</span> <span class="n">audit</span><span class="o">.</span><span class="n">get_app_logs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">app_logs</span><span class="p">:</span>
            <span class="n">log</span><span class="p">[</span><span class="s">&#39;application&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="k">return</span> <span class="n">app_logs</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-36'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-36'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">get_tag_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">tag</span>
        
        <span class="k">return</span> <span class="bp">False</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-37'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-37'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">freeze_requirements</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">reqs</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span> <span class="o">=</span> <span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">pckg</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">packages</span><span class="p">:</span>
            <span class="n">reqs</span> <span class="o">+=</span> <span class="n">pckg</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;==&#39;</span> <span class="o">+</span> <span class="n">pckg</span><span class="o">.</span><span class="n">version</span> <span class="o">+</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span>
        
        <span class="k">return</span> <span class="n">reqs</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-38'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-38'>#</a>
      </div>
      <p>Represents a python package</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Package</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-39'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-39'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">version</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">version</span> <span class="o">=</span> <span class="n">version</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-40'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-40'>#</a>
      </div>
      <p>Represents a git tag</p>
    </div>
    <div class='code'>
      <div class="highlight"><pre><span class="k">class</span> <span class="nc">Tag</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span></pre></div>
    </div>
  </div>
  <div class='clearall'></div>
  <div class='section' id='section-41'>
    <div class='docs'>
      <div class='octowrap'>
        <a class='octothorpe' href='#section-41'>#</a>
      </div>
      
    </div>
    <div class='code'>
      <div class="highlight"><pre>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">date</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>

</pre></div>
    </div>
  </div>
  <div class='clearall'></div>
</div>
<script src="pycco.js"></script>
</body>
